"use strict";(()=>{var e={};e.id=331,e.ids=[331],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},21764:e=>{e.exports=require("util")},59991:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>E,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{POST:()=>c,dynamic:()=>p});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),u=r(44171);let p="force-dynamic";async function c(e){try{let t;let{payment_intent_id:r,order_details:s}=await e.json();if(!r||"string"!=typeof r)return i.NextResponse.json({error:"Valid payment intent ID is required"},{status:400});if(!s||"object"!=typeof s)return i.NextResponse.json({error:"Order details are required"},{status:400});try{t=await u.Ag.paymentIntents.retrieve(r)}catch(e){return console.error("Error retrieving payment intent:",e),i.NextResponse.json({error:"Invalid payment intent ID"},{status:400})}if("succeeded"===t.status){let e={payment_intent_id:r,amount:t.amount/100,currency:t.currency.toUpperCase(),customer_email:s?.email||t.receipt_email,customer_name:`${s?.firstName||""} ${s?.lastName||""}`.trim(),shipping_address:{address:s?.address,apartment:s?.apartment,city:s?.city,province:s?.province,postal_code:s?.postalCode,country:s?.country||"Canada"},items:s?.items||[],subtotal:s?.subtotal||0,shipping:s?.shipping||0,tax:s?.tax||0,total:s?.total||t.amount/100,order_number:`FC${Date.now().toString().slice(-6)}`,status:"confirmed",created_at:new Date().toISOString(),stripe_payment_intent:t.id,payment_method:t.payment_method,metadata:t.metadata};return console.log("Order confirmed:",e),i.NextResponse.json({success:!0,order:{order_number:e.order_number,payment_intent_id:t.id,status:t.status,amount:t.amount/100,currency:t.currency.toUpperCase(),customer_email:e.customer_email,created_at:e.created_at},message:"Payment confirmed and order processed successfully"})}if("processing"===t.status)return i.NextResponse.json({success:!1,error:"Payment is still processing. Please wait a moment and try again.",status:t.status},{status:202});if("requires_payment_method"===t.status)return i.NextResponse.json({success:!1,error:"Payment requires a valid payment method. Please try again.",status:t.status},{status:400});if("requires_confirmation"===t.status)return i.NextResponse.json({success:!1,error:"Payment requires confirmation. Please complete the payment process.",status:t.status},{status:400});else if("canceled"===t.status)return i.NextResponse.json({success:!1,error:"Payment was canceled. Please try again.",status:t.status},{status:400});else return i.NextResponse.json({success:!1,error:`Payment not completed. Status: ${t.status}`,status:t.status},{status:400})}catch(e){if(console.error("Error confirming payment:",e),"StripeInvalidRequestError"===e.type)return i.NextResponse.json({error:"Invalid payment request. Please try again."},{status:400});if("StripeAPIError"===e.type)return i.NextResponse.json({error:"Payment service temporarily unavailable. Please try again."},{status:503});if("StripeConnectionError"===e.type)return i.NextResponse.json({error:"Network error. Please check your connection and try again."},{status:503});return i.NextResponse.json({error:"An unexpected error occurred while confirming your payment. Please contact support."},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/confirm-payment/route",pathname:"/api/confirm-payment",filename:"route",bundlePath:"app/api/confirm-payment/route"},resolvedPagePath:"/home/ubuntu/github_repos/segundofae/app/api/confirm-payment/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:y}=m,_="/api/confirm-payment/route";function E(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:d})}},44171:(e,t,r)=>{r.d(t,{Ag:()=>u}),r(30468);var s=r(31059);let a=()=>{let e={NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:"pk_test_51S3qr1HT8UTeXRMX8Bfp4pVx3jGVqJ0OLs7G5voYol7dxzoTHm4ICTUcImeZF2BjUAexdmdfnsP59RrvjQwSN7hG00TJRMiVSi",STRIPE_SECRET_KEY:process.env.STRIPE_SECRET_KEY,STRIPE_WEBHOOK_SECRET:process.env.STRIPE_WEBHOOK_SECRET},t=[],r=[];if(Object.entries(e).forEach(([e,s])=>{s?"NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY"===e&&s.includes("pk_test_temp")?r.push(`${e} is using a temporary/placeholder value`):"STRIPE_SECRET_KEY"!==e||s.startsWith("sk_")?"NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY"!==e||s.startsWith("pk_")||r.push(`${e} does not appear to be a valid Stripe publishable key`):r.push(`${e} does not appear to be a valid Stripe secret key`):t.push(e)}),t.length>0)throw Error(`Missing required Stripe environment variables: ${t.join(", ")}`);if(r.length>0)throw Error(`Invalid Stripe environment variables: ${r.join(", ")}`);return{publishableKey:e.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,secretKey:e.STRIPE_SECRET_KEY,webhookSecret:e.STRIPE_WEBHOOK_SECRET}},n=null,o=()=>(n||(n=a()),n),i=null,u=new Proxy({},{get(e,t){if(!i){let e=o();i=new s.Z(e.secretKey,{apiVersion:"2025-08-27.basil"})}return i[t]}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,50],()=>r(59991));module.exports=s})();