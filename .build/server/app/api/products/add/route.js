"use strict";(()=>{var e={};e.id=741,e.ids=[741],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92962:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>A,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{POST:()=>d,dynamic:()=>u});var o=r(49303),s=r(88716),i=r(60670),n=r(87070),c=r(83493);let u="force-dynamic";async function d(e){let t=Date.now();try{console.log("[API_PRODUCT_CREATE] Starting product creation request");let r=await e.json();console.log("[API_PRODUCT_CREATE] Received data:",{name:r.name,category:r.category,price:r.price,imagesCount:r.images?.length||0});let a=function(e){let t=[];(!e.name||"string"!=typeof e.name||e.name.trim().length<2)&&t.push("Product name is required and must be at least 2 characters"),(!e.price||"number"!=typeof e.price||e.price<=0||e.price>1e4)&&t.push("Price must be a valid positive number not exceeding $10,000"),(!e.description||"string"!=typeof e.description||e.description.trim().length<10)&&t.push("Description is required and must be at least 10 characters"),e.category&&"string"==typeof e.category||t.push("Category is required");let r=["necklaces","earrings","bracelets","and-more"];return e.category&&!r.includes(e.category)&&t.push("Invalid category. Must be one of: "+r.join(", ")),e.images&&Array.isArray(e.images)&&0!==e.images.length?e.images.filter(e=>{if("string"!=typeof e||!e.trim())return!0;try{return new URL(e),!1}catch{return!0}}).length>0&&t.push("All image URLs must be valid"):t.push("At least one product image is required"),void 0!==e.featured&&"boolean"!=typeof e.featured&&t.push("Featured must be a boolean value"),void 0!==e.inStock&&"boolean"!=typeof e.inStock&&t.push("InStock must be a boolean value"),e.materials&&!Array.isArray(e.materials)&&t.push("Materials must be an array"),{isValid:0===t.length,errors:t}}(r);if(!a.isValid)return console.log("[API_PRODUCT_CREATE] Validation failed:",a.errors),n.NextResponse.json({success:!1,error:"Validation failed",details:a.errors},{status:400});console.log("[API_PRODUCT_CREATE] Validation passed, preparing data for database");let o={name:r.name.trim(),price:r.price,description:r.description.trim(),longDescription:r.longDescription?.trim()||r.description.trim(),category:r.category,images:r.images.filter(e=>""!==e.trim()),featured:r.featured||!1,inStock:void 0===r.inStock||r.inStock,materials:r.materials||[],dimensions:r.dimensions?.trim()||null,care_instructions:r.care_instructions?.trim()||null};console.log("[API_PRODUCT_CREATE] Prisma data prepared:",{name:o.name,category:o.category,price:o.price,imagesCount:o.images.length,materialsCount:o.materials.length}),console.log("[API_PRODUCT_CREATE] Database URL configured:",!!process.env.DATABASE_URL);let s=await c._.$transaction(async e=>{console.log("[API_PRODUCT_CREATE] Starting database transaction");let t=await e.product.findFirst({where:{name:o.name,category:o.category}});if(t)throw console.log("[API_PRODUCT_CREATE] Duplicate product found:",t.id),Error(`A product with the name "${o.name}" already exists in the ${o.category} category`);console.log("[API_PRODUCT_CREATE] No duplicates found, creating product");let r=await e.product.create({data:o});return console.log("[API_PRODUCT_CREATE] Product created successfully:",{id:r.id,name:r.name,category:r.category}),r});return console.log(`[API_PRODUCT_CREATE] Transaction completed successfully (${Date.now()-t}ms)`),n.NextResponse.json({success:!0,message:"Product added successfully",product:{id:s.id,name:s.name,category:s.category,price:s.price,featured:s.featured,inStock:s.inStock}},{status:201})}catch(e){if(console.error(`[API_PRODUCT_CREATE] Error adding product (${Date.now()-t}ms):`,e),console.error("[API_PRODUCT_CREATE] Error details:",{message:e.message,code:e.code,stack:"Hidden in production"}),"P2002"===e.code)return console.log("[API_PRODUCT_CREATE] Prisma unique constraint violation"),n.NextResponse.json({success:!1,error:"A product with this information already exists"},{status:409});if("P1001"===e.code||"P1002"===e.code)return console.log("[API_PRODUCT_CREATE] Database connection error"),n.NextResponse.json({success:!1,error:"Database connection error. Please check your database configuration."},{status:503});if(e.message.includes("already exists"))return console.log("[API_PRODUCT_CREATE] Custom validation error"),n.NextResponse.json({success:!1,error:e.message},{status:409});return console.log("[API_PRODUCT_CREATE] Generic error occurred"),n.NextResponse.json({success:!1,error:"Failed to add product. Please try again.",details:void 0},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/products/add/route",pathname:"/api/products/add",filename:"route",bundlePath:"app/api/products/add/route"},resolvedPagePath:"/home/ubuntu/github_repos/segundofae/app/api/products/add/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m}=l,P="/api/products/add/route";function A(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},83493:(e,t,r)=>{r.d(t,{_:()=>o});let a=require("@prisma/client"),o=global.prisma||new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(92962));module.exports=a})();