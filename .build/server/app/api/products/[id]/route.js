"use strict";(()=>{var e={};e.id=898,e.ids=[898],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},77467:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>R,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>P});var s={};t.r(s),t.d(s,{GET:()=>p,PUT:()=>l,dynamic:()=>c});var o=t(49303),n=t(88716),a=t(60670),u=t(87070),i=t(83493);let c="force-dynamic";async function d(e){let r=Date.now();try{console.log(`[API_PRODUCT_SEARCH] Searching for product ID: "${e}"`);let t=await i._.product.findUnique({where:{id:e.trim()}});if(t)return console.log(`[API_PRODUCT_SEARCH] Product found: ${t.id} (${Date.now()-r}ms)`),{product:t,searchStrategy:"direct"};return console.log(`[API_PRODUCT_SEARCH] Product not found: "${e}" (${Date.now()-r}ms)`),null}catch(t){return console.error(`[API_PRODUCT_SEARCH] Error searching for product (${Date.now()-r}ms):`,t),console.error("[API_PRODUCT_SEARCH] Search ID:",e),null}}async function p(e,{params:r}){try{let{id:e}=r;if(!e||"string"!=typeof e||""===e.trim())return u.NextResponse.json({success:!1,error:"Product ID is required and must be a valid string"},{status:400});let t=e.trim(),s=await d(t);if(!s?.product)return u.NextResponse.json({success:!1,error:"Product not found",searchedId:t},{status:404});let{product:o,searchStrategy:n}=s,a=await i._.product.findMany({where:{category:o.category,id:{not:o.id}},take:4,orderBy:{created_at:"desc"}});return u.NextResponse.json({success:!0,product:o,relatedProducts:a,meta:{searchStrategy:n,originalId:t,foundId:o.id}},{status:200})}catch(e){if(console.error("Error fetching product:",e),"P2025"===e.code)return u.NextResponse.json({success:!1,error:"Product not found"},{status:404});if("P1001"===e.code||"P1002"===e.code)return u.NextResponse.json({success:!1,error:"Database connection error. Please try again later."},{status:503});return u.NextResponse.json({success:!1,error:"Failed to fetch product. Please try again.",details:void 0},{status:500})}}async function l(e,{params:r}){try{let{id:t}=r,s=await e.json();if(!t||"string"!=typeof t||""===t.trim())return u.NextResponse.json({success:!1,error:"Product ID is required and must be a valid string"},{status:400});let o=t.trim();if(void 0!==s.price&&("number"!=typeof s.price||s.price<=0))return u.NextResponse.json({success:!1,error:"Price must be a positive number"},{status:400});if(void 0!==s.name&&("string"!=typeof s.name||s.name.trim().length<2))return u.NextResponse.json({success:!1,error:"Name must be at least 2 characters long"},{status:400});let n=await i._.$transaction(async e=>{if(!await e.product.findUnique({where:{id:o}}))throw Error("PRODUCT_NOT_FOUND");return await e.product.update({where:{id:o},data:{...s,updatedAt:new Date}})});return console.log("Product updated successfully:",{id:n.id,name:n.name}),u.NextResponse.json({success:!0,message:"Product updated successfully",product:n},{status:200})}catch(e){if(console.error("Error updating product:",e),"PRODUCT_NOT_FOUND"===e.message||"P2025"===e.code)return u.NextResponse.json({success:!1,error:"Product not found"},{status:404});if("P2002"===e.code)return u.NextResponse.json({success:!1,error:"A product with this information already exists"},{status:409});return u.NextResponse.json({success:!1,error:"Failed to update product. Please try again.",details:void 0},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"/home/ubuntu/github_repos/segundofae/app/api/products/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:P,serverHooks:g}=m,h="/api/products/[id]/route";function R(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:P})}},83493:(e,r,t)=>{t.d(r,{_:()=>o});let s=require("@prisma/client"),o=globalThis.prisma??new s.PrismaClient({log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972],()=>t(77467));module.exports=s})();