"use strict";(()=>{var e={};e.id=898,e.ids=[898],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},77467:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>R,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>P,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>l,PUT:()=>p,dynamic:()=>u});var o=r(49303),a=r(88716),n=r(60670),i=r(87070),c=r(83493);let u="force-dynamic";async function d(e){let t=Date.now();try{console.log(`[API_PRODUCT_SEARCH] Starting flexible search for ID: "${e}"`);let r=await c._.product.findUnique({where:{id:e}});if(r)return console.log(`[API_PRODUCT_SEARCH] Direct match found: ${r.id} (${Date.now()-t}ms)`),{product:r,searchStrategy:"direct"};console.log("[API_PRODUCT_SEARCH] No direct match, trying flexible search...");let s=await c._.product.findMany({where:{OR:[{id:{contains:e,mode:"insensitive"}},{id:{startsWith:e,mode:"insensitive"}},{id:{endsWith:e,mode:"insensitive"}}]},take:10});if(console.log(`[API_PRODUCT_SEARCH] Similar ID search found ${s.length} products`),s.length>0)return console.log("[API_PRODUCT_SEARCH] Similar ID matches:",s.map(e=>e.id)),{product:s[0],searchStrategy:"similar_id",alternatives:s.slice(1)};let o=decodeURIComponent(e).split(/[-_\s]+/).filter(e=>e.length>2);if(console.log(`[API_PRODUCT_SEARCH] Search terms extracted: ${o.join(", ")}`),o.length>0){let e=await c._.product.findMany({where:{OR:o.map(e=>({name:{contains:e,mode:"insensitive"}}))},take:10});if(console.log(`[API_PRODUCT_SEARCH] Name search found ${e.length} products`),e.length>0)return console.log("[API_PRODUCT_SEARCH] Name search matches:",e.map(e=>`${e.id} (${e.name})`)),{product:e[0],searchStrategy:"name_search",alternatives:e.slice(1)}}console.log(`[API_PRODUCT_SEARCH] No product found after all strategies (${Date.now()-t}ms)`);let a=await c._.product.findMany({select:{id:!0,name:!0,category:!0},take:20});return console.log("[API_PRODUCT_SEARCH] Available products:",a.map(e=>`${e.id} (${e.category})`)),null}catch(r){return console.error(`[API_PRODUCT_SEARCH] Error in flexible product search (${Date.now()-t}ms):`,r),console.error("[API_PRODUCT_SEARCH] Search ID:",e),console.error("[API_PRODUCT_SEARCH] Database URL configured:",!!process.env.DATABASE_URL),null}}async function l(e,{params:t}){try{let{id:e}=t;if(!e||"string"!=typeof e||""===e.trim())return i.NextResponse.json({success:!1,error:"Product ID is required and must be a valid string"},{status:400});let r=e.trim(),s=await d(r);if(!s?.product)return i.NextResponse.json({success:!1,error:"Product not found",searchedId:r},{status:404});let{product:o,searchStrategy:a,alternatives:n}=s,u=await c._.product.findMany({where:{category:o.category,id:{not:o.id}},take:4,orderBy:{created_at:"desc"}});return i.NextResponse.json({success:!0,product:o,relatedProducts:u,meta:{searchStrategy:a,originalId:r,foundId:o.id,alternatives:n?.map(e=>({id:e.id,name:e.name}))||[]}},{status:200})}catch(e){if(console.error("Error fetching product:",e),"P2025"===e.code)return i.NextResponse.json({success:!1,error:"Product not found"},{status:404});if("P1001"===e.code||"P1002"===e.code)return i.NextResponse.json({success:!1,error:"Database connection error. Please try again later."},{status:503});return i.NextResponse.json({success:!1,error:"Failed to fetch product. Please try again.",details:void 0},{status:500})}}async function p(e,{params:t}){try{let{id:r}=t,s=await e.json();if(!r||"string"!=typeof r||""===r.trim())return i.NextResponse.json({success:!1,error:"Product ID is required and must be a valid string"},{status:400});let o=r.trim();if(void 0!==s.price&&("number"!=typeof s.price||s.price<=0))return i.NextResponse.json({success:!1,error:"Price must be a positive number"},{status:400});if(void 0!==s.name&&("string"!=typeof s.name||s.name.trim().length<2))return i.NextResponse.json({success:!1,error:"Name must be at least 2 characters long"},{status:400});let a=await c._.$transaction(async e=>{if(!await e.product.findUnique({where:{id:o}}))throw Error("PRODUCT_NOT_FOUND");return await e.product.update({where:{id:o},data:{...s,updated_at:new Date}})});return console.log("Product updated successfully:",{id:a.id,name:a.name}),i.NextResponse.json({success:!0,message:"Product updated successfully",product:a},{status:200})}catch(e){if(console.error("Error updating product:",e),"PRODUCT_NOT_FOUND"===e.message||"P2025"===e.code)return i.NextResponse.json({success:!1,error:"Product not found"},{status:404});if("P2002"===e.code)return i.NextResponse.json({success:!1,error:"A product with this information already exists"},{status:409});return i.NextResponse.json({success:!1,error:"Failed to update product. Please try again.",details:void 0},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"/home/ubuntu/github_repos/segundofae/app/api/products/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:P}=m,h="/api/products/[id]/route";function R(){return(0,n.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:g})}},83493:(e,t,r)=>{r.d(t,{_:()=>o});let s=require("@prisma/client"),o=global.prisma||new s.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(77467));module.exports=s})();