"use strict";(()=>{var e={};e.id=684,e.ids=[684],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7552:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>$,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var t={};o.r(t),o.d(t,{GET:()=>u,dynamic:()=>l});var a=o(49303),s=o(88716),n=o(60670),c=o(87070),i=o(83493);let l="force-dynamic";async function u(e){let r=Date.now(),o=Math.random().toString(36).substring(7);try{let{searchParams:t}=new URL(e.url),a=t.get("category"),s=t.get("subcategory"),n=t.get("featured"),l=t.get("limit");console.log(`[API:${o}] üöÄ Starting request - category: ${a}, subcategory: ${s}, featured: ${n}, limit: ${l}`);try{await i._.$connect(),console.log(`[API:${o}] ‚úÖ Database connection successful`)}catch(e){throw console.error(`[API:${o}] ‚ùå Database connection failed:`,e),Error(`Database connection failed: ${e instanceof Error?e.message:"Unknown DB error"}`)}let u={};if(a&&"all"!==a){let e={"and-more":"and-more",necklaces:"necklaces",earrings:"earrings",bracelets:"bracelets",anklets:"anklets"}[a]||a;u.category=e,console.log(`[API:${o}] üîÑ Mapped category '${a}' to '${e}'`),["necklaces","earrings","bracelets","and-more","anklets"].includes(e)||console.warn(`[API:${o}] ‚ö†Ô∏è Invalid category '${e}', proceeding anyway`)}s&&"all"!==s&&(u.subcategory=s.toLowerCase(),console.log(`[API:${o}] üè∑Ô∏è Filtering by subcategory: ${s}`)),"true"===n&&(u.featured=!0,console.log(`[API:${o}] ‚≠ê Filtering for featured products`));let d=l?parseInt(l,10):void 0;d&&(d<1||d>100)&&console.warn(`[API:${o}] ‚ö†Ô∏è Invalid limit ${d}, using default`),console.log(`[API:${o}] üîç Prisma query where:`,JSON.stringify(u,null,2));let p=Date.now(),g=await Promise.race([i._.product.findMany({where:u,take:d&&d>0&&d<=100?d:void 0,orderBy:{created_at:"desc"}}),new Promise((e,r)=>setTimeout(()=>r(Error("Query timeout after 10 seconds")),1e4))]),m=Date.now()-p;if(console.log(`[API:${o}] ‚úÖ Query completed in ${m}ms - Found ${g.length} products`),!Array.isArray(g))throw Error("Invalid products data returned from database");g.length>0?(console.log(`[API:${o}] üì¶ Products found:`),g.forEach((e,r)=>{console.log(`[API:${o}]   ${r+1}. ${e.name} (${e.category})`)})):console.log(`[API:${o}] üì≠ No products found for query`);let $=Date.now()-r;return console.log(`[API:${o}] üèÅ Request completed in ${$}ms`),c.NextResponse.json({success:!0,products:g,total:g.length,query:{category:a,subcategory:s,featured:n,limit:l,mappedCategory:u.category,requestId:o,queryTime:`${m}ms`,totalTime:`${$}ms`},timestamp:new Date().toISOString()})}catch(t){let e=Date.now()-r;return console.error(`[API:${o}] ‚ùå Error after ${e}ms:`,t),t instanceof Error&&(console.error(`[API:${o}] Error name:`,t.name),console.error(`[API:${o}] Error message:`,t.message),console.error(`[API:${o}] Error stack:`,t.stack)),t&&"object"==typeof t&&"code"in t&&(console.error(`[API:${o}] Prisma error code:`,t.code),console.error(`[API:${o}] Prisma error meta:`,t.meta)),c.NextResponse.json({success:!1,error:"Failed to fetch products",products:[],total:0,details:"Failed to fetch products",requestId:o,timestamp:new Date().toISOString(),totalTime:`${e}ms`},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"/home/ubuntu/github_repos/segundofae/app/api/products/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m}=d,$="/api/products/route";function y(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},83493:(e,r,o)=>{o.d(r,{_:()=>a});let t=require("@prisma/client"),a=globalThis.prisma??new t.PrismaClient({log:["error"]})}};var r=require("../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[276,972],()=>o(7552));module.exports=t})();